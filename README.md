# Opal toolset

A set of tools for managing and analysing Opal devices.

For correct functioning, the tools should be used with Opal-compliant devices and under superuser account.

## Building

```console
# make
```

## Parameters discovery

The `discovery` tool prints Discovery information of an Opal device.

```console
# ./discovery /dev/sdb 4
```
```json
{
"Discovery 1": {
  "Properties": {
    "MaxComPacketSize": "0x00007e00",
    "MaxResponseComPacketSize": "0x00007e00",
    "MaxPacketSize": "0x00007dec",
    "MaxIndTokenSize": "0x00007dc8",
    "MaxPackets": "0x00000001",
    "MaxSubpackets": "0x00000001",
    "MaxMethods": "0x00000001",
    "MaxSessions": "0x00000001",
    "MaxAuthentications": "0x0000000e",
    "MaxTransactionLimit": "0x00000001",
    "DefSessionTimeout": "0x000493e0",
    "MaxSessionTimeout": "0x00000000",
    "MinSessionTimeout": "0x00001388"
  }
}}
```

## Random number generation

The `rng` tool prints bytes generated by the Random method of an Opal device.

```console
# ./rng /dev/sdb 32 4
```
```console
d75b8ccfd89a4eb8ca2dccb20ba7450f652b13faeda84d45de83587cad4f63b1
9368e5d3d0baba55d989a8bcf36fe192fa356aff8b8d16c6ba3c1f8f4f0cf16d
2c33d8c21d6f2e80d52987ea31e28cb0b84782a7db01120a506aa34990de0c68
d5453a4fc6450f790bb37ef9fc1993ce47f5e17f78dbd573dd27e876e8a72931
```

## Device management

The `control` tool allows management of an Opal device.

```console
# ./control psid_revert /dev/sda --verify-pin "${PSID}"
# ./control setup_tper /dev/sda --assign-pin 000000
# ./control setup_user /dev/sda --user 1 --verify-pin 000000 --assign-pin 111111
# ./control setup_range /dev/sda --locking-range 1 --locking-range-start 512 --locking-range-length 512 --verify-pin 000000
# ./control unlock /dev/sda --user 1 --verify-pin 111111 --locking-range 1 --read-locked 1
```
